## Program Encodings
#cspp/3-2

**Compiling with GCC**
![](Pasted%20image%2020240206162940.png)
`{sh}gcc -0g -o p p1.c p2.c` compiles `p1.c` and `p2.c` without any optimisations.

Processer state visible to assembly but not c:
- *Program counter*: address of the next instruction to execute
- *register file*: 16 named locations for 64-bit values. Some temp, some critical.
- *condition registers*: records the result from latest arithmetic or logical instruction
- *set of vector registers*: Holds one or more integer or floating point values

**Code Example**
```c
long mult2(long, long);

void multstore(long x, long y, long *dest) {
	long t = mult2(x, y);
	*dest = t;
}
```
becomes
```nasm
multstore:
  pushq %rbx        ;Save %rbx
  movq %rdx, %rbx   ;Copy dest to %rbx
  call mult2        ;Call mult2(x, y)
  movq %rax, (%rbx) ;Store result at *dest
  popq %rbx         ;Restore %rbx
  ret               ;Return
```

## Data Formats
`word` in x86-64 is 2 bytes, even if actual word size is 8
![](Pasted%20image%2020240219194039.png)
Assembly suffixes are appended to operations to indicate word size

## Accessing Data
![](Pasted%20image%2020240219194554.png)
*xh is the higher byte of xx*
Writing behaves differently depending on size
- 1 and 2 bytes leave upper bits intact
- 4 bytes set upper bits to 0

**Operands for specifying values**
memory operands are all simplified variations of the last one

![](Pasted%20image%2020240219195036.png)

**$\texttt{leaq}$ is weird**
Can be (ab)used for math
$\texttt{leaq    (a,b,c), dest}\Leftrightarrow dest=a+c\cdot b$

## ISA
*Instruction set architecture*
#caos/lecture/3
![](Pasted%20image%2020240221082735.png)![](Pasted%20image%2020240221082805.png)
- RISC
	- FÃ¥ instruktioner der kan eksekveres hurtigt
- CISC
	- Flere instruktioner som er mere komplekse for hardware. Langsommere men flere muligheder.